const GTDCTRLVer="12.03",DocManVer="14.03";function _UpdateDocCategory(e,t){console.log("UpdateDocCategory: called ver=14.03");_GenericFlowHandler("/_api/cloudflow/v1.0/trigger/4c999c4e-3495-f011-b41b-002248c5d639",{ActionType:"UpdateDocCat",DocCategory:e,AccGUID:"",DocManRowGuid:t}).done((function(e){console.log("UpdateCat: Passed-GUID-"+t+" -response:"+e)})).fail((function(e){console.log("UpdateCat: Error-GUID-"+t+" -response:"+e)})).always((function(){}))}function extractSasToken(e){var t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return-1!==t.indexOf("sig=")||-1!==t.indexOf("?sv=")?t:""}if(!t||"object"!=typeof t)return"";for(var r=[t.sasToken,t.sas,t.token,t.sas_token,t.SASToken,t.url,t.sasUrl],i=0;i<r.length;i++)if("string"==typeof r[i]&&r[i])return r[i];for(var n=Object.keys(t),o=0;o<n.length;o++){var a=t[n[o]];if("string"==typeof a&&(-1!==a.indexOf("sig=")||-1!==a.indexOf("?sv=")))return a}return""}function _ParsePowerPagesErrorMetadata(e){var t=e||"",r="",i="",n="",o=null;if(t&&("{"===t.charAt(0)||"["===t.charAt(0)))try{o=JSON.parse(t)}catch(e){o=null}if(o&&"object"==typeof o){var a="";"string"==typeof o.Message?a=o.Message:"string"==typeof o.message&&(a=o.message);var l=/tracking\s+id\s+is\s+["'\u0027]*([0-9a-fA-F-]{36})/i.exec(a);l&&l[1]&&(n=l[1])}var s=/correlationId:\s*'([0-9a-fA-F-]{36})'/i.exec(t)||/Error\s*ID\s*#\s*\[([0-9a-fA-F-]{36})\]/i.exec(t)||/CorrelationId\s*:\s*([0-9a-fA-F-]{36})/i.exec(t);s&&s[1]&&(r=s[1]);var c=/Error\s*ID\s*#\s*\[([^\]]+)\]/i.exec(t);if(c&&c[1]&&(i=c[1]),!n){var u=/tracking\s+id\s+is\s+["'\u0027]*([0-9a-fA-F-]{36})/i.exec(t);u&&u[1]&&(n=u[1])}return!i&&r&&(i=r),{correlationId:r,errorId:i,flowTrackingId:n,hasPowerAutomateErrorView:-1!==t.indexOf("~/Areas/PowerAutomate/Views/PowerAutomate/Error")}}function _PreflightCloudFlowCheck(e,t){var r=window.Microsoft&&window.Microsoft.Dynamic365&&window.Microsoft.Dynamic365.Portal?window.Microsoft.Dynamic365.Portal:null,i=/^\/_api\/cloudflow\/v1\.0\/trigger\/([0-9a-fA-F-]{36})$/.exec(e||""),n=i?i[1]:"",o=t&&"object"==typeof t?Object.keys(t):[],a={timestamp:(new Date).toISOString(),flowUrl:e,triggerId:n,isCloudFlowEndpointPattern:!!i,pageUrl:window.location.href,origin:window.location.origin,hasShellAjaxSafePost:"undefined"!=typeof shell&&shell&&"function"==typeof shell.ajaxSafePost,hasJQuery:"undefined"!=typeof $,payloadType:typeof t,payloadKeys:o,portalContextAvailable:!!r,portalId:r&&r.id?r.id:"",portalType:r&&r.type?r.type:"",portalVersion:r&&r.version?r.version:"",tenant:r&&r.tenant?r.tenant:"",geo:r&&r.geo?r.geo:"",contactId:r&&r.User&&r.User.contactId?r.User.contactId:""};return console.log("_PreflightCloudFlowCheck: summary",a),a.isCloudFlowEndpointPattern||console.error("_PreflightCloudFlowCheck: flowUrl format does not match /_api/cloudflow/v1.0/trigger/{guid}",{flowUrl:e}),a.triggerId||console.error("_PreflightCloudFlowCheck: no triggerId detected in URL."),a.portalContextAvailable||console.error("_PreflightCloudFlowCheck: Microsoft.Dynamic365.Portal context not found on page."),a.contactId||console.warn("_PreflightCloudFlowCheck: no contactId found in portal context. Authenticated user may be required by flow permissions."),console.log("_PreflightCloudFlowCheck: checklist",{step1_enableCloudFlowIntegration:"Verify Power Pages cloud flow integration is enabled in site settings",step2_flowBinding:"Verify this trigger ID belongs to current site/environment and is bound to this page context",step3_permissions:"Verify current user has permission to run the flow",step4_triggerSchema:"Verify trigger expects eventData with text/number in current stage",step5_publishAndRetry:"Republish flow and retry from same portal environment"}),a}function _GenericFlowHandler(e,t){var r=Date.now();console.log("_GenericFlowHandler: ver","DocManVer"),console.log("_GenericFlowHandler: flowUrl",e),console.log("_GenericFlowHandler: payload (raw)",t),console.log("_GenericFlowHandler: payload typeof",typeof t);var i="";try{i=JSON.stringify(t),console.log("_GenericFlowHandler: payload stringify success",i)}catch(e){console.error("_GenericFlowHandler: payload stringify failed",e)}var n={type:"POST",url:e,data:{eventData:JSON.stringify(t)}};console.log("_GenericFlowHandler: requestConfig",{type:n.type,contentType:n.contentType,url:n.url,processData:n.processData,global:n.global,dataPreview:n.data});var o=shell.ajaxSafePost(n);return o.done((function(e,t,i){console.log("_GenericFlowHandler: DONE",{durationMs:Date.now()-r,textStatus:t,status:i&&"number"==typeof i.status?i.status:null,responseData:e})})),o.fail((function(i,n,o){var a=i&&i.responseText?i.responseText:"",l=a?a.substring(0,700):"",s=_ParsePowerPagesErrorMetadata(a),c=s.hasPowerAutomateErrorView;console.error("_GenericFlowHandler: FAIL",{durationMs:Date.now()-r,textStatus:n,errorThrown:o?String(o):"",status:i&&"number"==typeof i.status?i.status:null,statusText:i&&i.statusText?i.statusText:"",responseText:a,isPowerAutomateErrorView:c,correlationId:s.correlationId,errorId:s.errorId,flowTrackingId:s.flowTrackingId}),console.error("_GenericFlowHandler: FAIL response snippet",l),c&&console.error("_GenericFlowHandler: The cloud flow trigger endpoint exists but failed server-side in Power Pages. Check site settings for Power Automate integration, flow binding/permissions, and whether the trigger ID belongs to the current site/environment."),console.error("_GenericFlowHandler: Running preflight diagnostics due to flow failure"),_PreflightCloudFlowCheck(e,t)})),console.log("_GenericFlowHandler: request sent"),o}class PowerPagesListMenuEnhancer{constructor(e){e=e||{},this.logPrefix=e.logPrefix||"[PowerPagesListMenuEnhancer]",this.triggerSelector=e.triggerSelector||"[data-automation-key='ppNativeListContextualMenu']",this.listKey=e.listKey||null,this.listSelector=e.listSelector||(this.listKey?"pages-grid[list-id='"+this.escapeCssAttrValue(this.listKey)+"']":null),this.guidSelector=e.guidSelector||null,this.instanceKey=e.instanceKey||(this.logPrefix+(this.listSelector||"")).replace(/[^a-zA-Z0-9_-]/g,"_"),this.pendingRowContext=null,this.menuObserver=null,this.actions=[],this.isAwaitingMenuForClick=!1,this.debug=!!e.debug,this.nativeActionsConfig=e.nativeActionsConfig||{},this.nativeActionLabelsToHide=Array.isArray(this.nativeActionsConfig.labelsToHide)?this.nativeActionsConfig.labelsToHide:[],this.icons={gear:'<path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a1.873 1.873 0 0 1-2.292 1.226l-.314-.093c-1.79-.527-3.065 1.748-1.933 3.165l.2.25a1.873 1.873 0 0 1 0 2.58l-.2.25c-1.132 1.417.143 3.692 1.933 3.165l.314-.093a1.873 1.873 0 0 1 2.292 1.226l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a1.873 1.873 0 0 1 2.292-1.226l.314.093c1.79.527 3.065-1.748 1.933-3.165l-.2-.25a1.873 1.873 0 0 1 0-2.58l.2-.25c1.132-1.417-.143-3.692-1.933-3.165l-.314.093a1.873 1.873 0 0 1-2.292-1.226l-.094-.319z"/>',pencil:'<path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L5.207 14.5H2v-3.207z"/><path fill-rule="evenodd" d="M1 13.5V16h2.5l8.793-8.793-2.5-2.5z"/>'},this.ensureStylesInjected()}log(){var e=Array.prototype.slice.call(arguments);e.unshift(this.logPrefix),console.log.apply(console,e)}debugLog(){if(this.debug){var e=Array.prototype.slice.call(arguments);e.unshift(this.logPrefix),e.unshift("[debug]"),console.log.apply(console,e)}}normalizeText(e){return String(e||"").replace(/\s+/g," ").trim().toLowerCase()}decodeUriSafe(e){if(null==e)return"";var t=String(e);try{return decodeURIComponent(t)}catch(e){return t}}formatCompactGuid(e){var t=String(e||"").replace(/[^0-9a-fA-F]/g,"");return 32!==t.length?null:(t.slice(0,8)+"-"+t.slice(8,12)+"-"+t.slice(12,16)+"-"+t.slice(16,20)+"-"+t.slice(20)).toLowerCase()}extractGuid(e){for(var t=String(e||""),r=[t,this.decodeUriSafe(t)],i=0;i<r.length;i++){var n=r[i];if(n){var o=n.match(/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}/);if(o)return o[0].toLowerCase();var a=n.match(/\b[0-9a-fA-F]{32}\b/);if(a)return this.formatCompactGuid(a[0])}}return null}extractGuidFromElement(e){if(!e)return null;for(var t=["data-guid","data-id","data-record-id","data-entityid","data-row-id","value","id","href","onclick","aria-label","name"],r=0;r<t.length;r++){var i=e.getAttribute(t[r]),n=this.extractGuid(i);if(n)return n}if(e.attributes&&e.attributes.length)for(var o=0;o<e.attributes.length;o++){var a=e.attributes[o];if(a){var l=this.extractGuid(a.value);if(l)return l}}if("string"==typeof e.value){var s=this.extractGuid(e.value);if(s)return s}var c=this.extractGuid(e.textContent);return c||this.extractGuid(e.innerHTML)}getGuidFromRow(e){if(!e)return null;var t=null;if(this.guidSelector){var r=null;if(r="function"==typeof e.matches&&e.matches(this.guidSelector)?e:e.querySelector(this.guidSelector),t=this.extractGuidFromElement(r))return t}if(t=this.extractGuidFromElement(e))return t;for(var i=e.querySelectorAll("input[type='hidden']"),n=0;n<i.length;n++)if(t=this.extractGuidFromElement(i[n]))return t;for(var o=e.querySelectorAll("[role='gridcell'], td"),a=0;a<o.length;a++)if(t=this.extractGuidFromElement(o[a]))return t;return null}getGuidFromTrigger(e){if(!e)return null;for(var t=e;t&&t!==document.body;){var r=this.extractGuidFromElement(t);if(r)return r;t=t.parentElement}var i=this.extractGuid(e.outerHTML);return i||null}getGuidFromMenuRoot(e){if(!e)return null;var t=e.querySelectorAll("*"),r=this.extractGuidFromElement(e);if(r)return r;for(var i=0;i<t.length;i++){var n=t[i],o=this.extractGuidFromElement(n);if(o)return o;var a=this.extractGuid(n.getAttribute("href"));if(a)return a;var l=this.extractGuid(n.getAttribute("onclick"));if(l)return l}return this.extractGuid(e.outerHTML)}resolveContextGuid(e,t){var r=e||{};if(r.guid)return r;var i=null,n=null;return r.row&&(i=this.getGuidFromRow(r.row))&&(n="row"),!i&&r.trigger&&(i=this.getGuidFromTrigger(r.trigger))&&(n="trigger"),i||(i=this.getGuidFromMenuRoot(t))&&(n="native-menu"),i?(this.log("Resolved GUID from",n+":",i),Object.assign({},r,{guid:i,guidSource:n})):r}escapeCssAttrValue(e){return String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'")}ensureStylesInjected(){var e="pp-custom-actions-styles";if(!document.getElementById(e)){var t=document.createElement("style");t.id=e,t.textContent=".custom-menu-action { justify-content: flex-start; }.custom-menu-action:hover, .custom-menu-action:focus-visible { background-color: var(--bs-dropdown-link-hover-bg, rgba(0, 0, 0, 0.05)); color: var(--bs-dropdown-link-hover-color, inherit);}",document.head.appendChild(t)}}createSvgIcon(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width","16"),r.setAttribute("height","16"),r.setAttribute("fill","currentColor"),r.setAttribute("viewBox","0 0 16 16"),r.setAttribute("aria-hidden","true"),r.innerHTML=e,t&&(r.style.color=t),r}createIcon(e,t){var r=this.icons[e];return r?this.createSvgIcon(r,t):null}collectMatchesDeep(e,t){var r=[];if(!e||!t)return r;return function e(i){if(i){1===i.nodeType&&"function"==typeof i.matches&&i.matches(t)&&r.push(i);for(var n=i.children||[],o=0;o<n.length;o++)e(n[o]);i.shadowRoot&&e(i.shadowRoot)}}(e),r}findFirstDeep(e,t){var r=this.collectMatchesDeep(e,t);return r.length?r[0]:null}findScopedHostFromTrigger(e){if(!e)return null;if(this.listSelector){var t=e.closest(this.listSelector);if(t)return t}if(this.listKey)for(var r="pages-grid[list-id='"+this.escapeCssAttrValue(this.listKey)+"']",i=document.querySelectorAll("pages-native-container"),n=0;n<i.length;n++){var o=i[n];if(o.querySelector(r)&&o.contains(e))return o}return null}getRowContextFromTrigger(e){var t=e.closest("[role='row'], tr");if(!t)return null;var r=t.querySelector("[role='gridcell'], td"),i=r?(r.innerText||"").trim():"Row",n=this.findScopedHostFromTrigger(e);return{row:t,label:i,guid:this.getGuidFromRow(t),trigger:e,listRoot:n,listKey:this.listKey||null}}getRowContextFromRow(e,t){if(!e)return null;var r=e.querySelector("[role='gridcell'], td");return{row:e,label:r?(r.innerText||"").trim():"Row",guid:this.getGuidFromRow(e),listRoot:t||null,listKey:this.listKey||null}}isTriggerInScope(e){return!this.listSelector&&!this.listKey||!!this.findScopedHostFromTrigger(e)}findOpenMenuRoot(){var e=Array.from(document.querySelectorAll("[role='menu']"));if(!e.length)return null;for(var t=e.length-1;t>=0;t--){var r=e[t],i=window.getComputedStyle(r);if("none"!==i.display&&"hidden"!==i.visibility)return r}return null}getScopedListRoots(){if(this.listSelector)return this.collectMatchesDeep(document,this.listSelector);if(this.listKey){var e="pages-grid[list-id='"+this.escapeCssAttrValue(this.listKey)+"']";return this.collectMatchesDeep(document,e)}return this.collectMatchesDeep(document,"pages-grid")}listHasNativeActions(e){return!!e&&!!this.findFirstDeep(e,this.triggerSelector)}addAction(e){if(!e||!e.id||!e.label||"function"!=typeof e.onClick)throw new Error("Action must include: id, label, onClick(context)");return this.actions.push({id:e.id,label:e.label,ariaLabel:e.ariaLabel||e.label,icon:e.icon||null,onClick:e.onClick}),this}addActions(e){if(!Array.isArray(e))throw new Error("addActions expects an array of action configs");for(var t=0;t<e.length;t++)this.addAction(e[t]);return this}createMenuItem(e,t){var r=document.createElement("button");r.type="button",r.setAttribute("role","menuitem"),r.className="dropdown-item custom-menu-action custom-menu-action-"+e.id,r.setAttribute("data-custom-action-id",this.instanceKey+"__"+e.id),r.setAttribute("aria-label",e.ariaLabel),r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.width="100%",r.style.textAlign="left",r.style.padding="8px 12px",r.style.cursor="pointer",e.icon&&r.appendChild(e.icon.cloneNode(!0));var i=document.createElement("span");return i.textContent=e.label,r.appendChild(i),r.addEventListener("click",(function(r){r.preventDefault(),r.stopPropagation(),e.onClick(t||{})})),r}injectIntoMenu(e,t){if(!e||!this.actions.length)return!1;var r=this.resolveContextGuid(t,e);this.applyNativeActionVisibility(e);for(var i=e.querySelectorAll("[role='menuitem']"),n=i.length&&i[i.length-1].parentElement||e,o=0,a=0;a<this.actions.length;a++){var l=this.actions[a],s=this.instanceKey+"__"+l.id;e.querySelector("[data-custom-action-id='"+s+"']")||(n.appendChild(this.createMenuItem(l,r)),o++)}return o>0&&this.log("Injected",o,"custom action(s) into dropdown menu."),o>0}isCustomMenuItem(e){return!!e&&0===(e.getAttribute("data-custom-action-id")||"").indexOf(this.instanceKey+"__")}matchesNativeActionLabel(e){if(!e||!this.nativeActionLabelsToHide.length)return!1;for(var t=[this.normalizeText(e.textContent),this.normalizeText(e.getAttribute("aria-label")),this.normalizeText(e.getAttribute("title")),this.normalizeText(e.getAttribute("data-original-title"))],r=!1,i=0;i<t.length;i++)if(t[i]){r=!0;break}if(!r)return!1;for(var n=0;n<this.nativeActionLabelsToHide.length;n++){var o=this.nativeActionLabelsToHide[n];if(o&&"string"==typeof o)for(var a=this.normalizeText(o),l=0;l<t.length;l++){var s=t[l];if(s&&(s===a||0===s.indexOf(a)))return!0}}return!1}shouldHideNativeAction(e){return this.matchesNativeActionLabel(e)}applyNativeActionVisibility(e){if(e&&this.nativeActionLabelsToHide.length){var t=e.querySelectorAll("[role='menuitem']"),r=0;this.debugLog("Scanning menu items:",t.length);for(var i=0;i<t.length;i++){var n=t[i];if(!this.isCustomMenuItem(n)){var o=this.shouldHideNativeAction(n);this.debugLog("Native menu item",i,{text:this.normalizeText(n.textContent),ariaLabel:this.normalizeText(n.getAttribute("aria-label")),title:this.normalizeText(n.getAttribute("title")),matched:o}),o&&(n.style.display="none",n.setAttribute("aria-hidden","true"),r++)}}r>0?this.log("Native action(s) hidden:",r):this.debugLog("No native actions matched hide rules.")}}tryInjectAfterOpen(){if(this.isAwaitingMenuForClick)var e=0,t=this,r=setInterval((function(){e++;var i=t.findOpenMenuRoot();i&&t.injectIntoMenu(i,t.pendingRowContext)?(clearInterval(r),t.isAwaitingMenuForClick=!1):e>=20&&(clearInterval(r),t.isAwaitingMenuForClick=!1,t.log("No open menu detected for injection."))}),100)}startMenuObserver(){if(!this.menuObserver){var e=this;this.menuObserver=new MutationObserver((function(){if(e.isAwaitingMenuForClick){var t=e.findOpenMenuRoot();if(t)e.injectIntoMenu(t,e.pendingRowContext)&&(e.isAwaitingMenuForClick=!1)}})),this.menuObserver.observe(document.body,{childList:!0,subtree:!0}),this.log("Menu observer started.")}}init(){var e=this;return document.addEventListener("click",(function(t){var r=t.target.closest(e.triggerSelector);r&&e.isTriggerInScope(r)&&(e.pendingRowContext=e.getRowContextFromTrigger(r),e.isAwaitingMenuForClick=!0,e.log("Context menu trigger clicked for row:",e.pendingRowContext?e.pendingRowContext.label:"(unknown)"),e.tryInjectAfterOpen())})),e.startMenuObserver(),e}}